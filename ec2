version: '3'
services:
  dm-fit-apps:
    image: ${DM_ECR_REPO}/dm-fit-apps:${DM_BUILD_TAG}
    container_name: dm-fit-apps
    ports:
      - 80:80
    volumes:
      - ${DM_CONTAINER}/logs/fitapps:/usr/local/tomcat/logs
      - ${DM_CONTAINER}/servers/dm-fit-apps:/usr/share/nginx/servers
    extra_hosts:
      - host.docker.internal:host-gateway
  dm-rest:
    image: ${DM_ECR_REPO}/dm-rest-services:${DM_BUILD_TAG}
    container_name: dm-rest
    environment:
      - dbhost=${DM_DB_HOST}
      - dbport=5432
      - mqhost=host.docker.internal
      - mqport=61616
      - tadb=${DM_TA_DB_NAME}
      - tadbuser=${DM_TA_USERNAME}
      - tadbpassword=${DM_TA_PASSWORD}
      - nodename=dm
      - debug=true
      - ssmregion=${SSMREGION}
      - ssmkeyprefix=${SSMKEYPREFIX}
      - smartsdecisionservicehost=${SMARTSDECISIONSERVICEHOST}
      - smartsdecisionmanagerhost=${SMARTSDECISIONMANAGERHOST}
    volumes:
      - ${DM_CONTAINER}/logs/rest:/usr/local/tomcat/logs
      - ${DM_DMFS_FOLDER}:/usr/local/dm
